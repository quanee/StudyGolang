### 限流

##### 单点限流
- 令牌桶、漏桶
- QPS 限流
- 给每个用户设置限制
- 按照优先级丢弃
- 拒绝请求

##### 自适应限流
- 过载保护
    - 滑动窗口统计系统负载
    - 使用冷却时间防止系统负载

##### 分布式限流
- 设置单个节点资源获取速率
- 基于历史窗口动态设置资源获取速率
- 公平按需分配资源

##### 主动限制客户端请求频次

### 熔断
- 使用滑动窗口统计请求出错率超出配额后, 直接拒绝

### 降级
- 保留核心服务, 牺牲不重要服务
- 使用缓存
- 存储延迟满足
- 回滚, 重启


### 重试注意事项
- 限制重试次数
- 客户端记录重试次数
- 在失败的层进行重试, 使用全局错误码
- 业务不幂等，导致的重试，数据重复
- 多层级重试传递，放大流量引起雪崩


### 负载均衡

- 根据指标(cpu, latency)对节点进行打分, 将流量转发给得分高的节点
- 对新启动的节点使用常量惩罚值（penalty），以及使用探针方式最小化放量，进行预热
- 打分比较低的节点，避免进入“永久黑名单”而无法恢复，使用统计衰减的方式，让节点指标逐渐恢复到初始状态
- 当前发出去的请求超过了 predict lagtency，增加惩罚
